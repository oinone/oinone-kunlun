import { DomEditor, IDomEditor, IModalMenu, t } from '@wangeditor/core';
import { DOMElement } from '@wangeditor/editor/dist/editor/src/utils/dom';
import { translateValueByKey } from '@kunlun/engine';
import { createExpressionDialog } from './util';

// 定义菜单 class
export class IExpressionModalMenu implements IModalMenu {
  // 菜单配置，代码可参考“插入链接”菜单源码
  readonly title = translateValueByKey('插入表达式');

  readonly iconSvg =
    '<svg class="icon" style="width: 1em;height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5083"><path d="M233.642667 944.412444v-53.703111H188.871111a32.426667 32.426667 0 0 1-21.504-6.712889 47.957333 47.957333 0 0 1-12.970667-17.863111c-3.413333-7.964444-5.688889-16.497778-6.712888-25.031111-1.137778-9.102222-1.763556-18.204444-1.763556-27.306666V650.808889c0-22.755556-3.128889-41.528889-9.443556-56.433778a127.032889 127.032889 0 0 0-21.902222-36.238222 84.935111 84.935111 0 0 0-25.486222-20.138667 69.575111 69.575111 0 0 0-21.048889-7.168v-2.673778c18.147556-5.347556 34.304-15.928889 46.535111-30.435555 8.362667-9.500444 15.644444-21.617778 21.902222-36.238222 6.257778-14.677333 9.443556-32.426667 9.443556-53.248v-163.84c0-9.500444 0.568889-18.944 1.763556-28.16 1.137778-9.329778 3.413333-17.464889 6.712888-24.632889a48.696889 48.696889 0 0 1 12.970667-17.464889 32.426667 32.426667 0 0 1 21.504-6.712889h44.771556V113.777778H170.951111c-11.377778 0-22.641778 2.503111-34.019555 7.623111-11.377778 5.006222-21.617778 12.515556-30.833778 22.357333a118.101333 118.101333 0 0 0-22.869334 36.693334 132.494222 132.494222 0 0 0-8.931555 50.631111v162.872889c0 15.473778-2.048 29.809778-6.257778 42.951111a113.777778 113.777778 0 0 1-16.554667 33.564444c-6.314667 8.760889-14.392889 16.099556-23.722666 21.504A55.580444 55.580444 0 0 1 0 499.484444v60.871112c9.500444 0 18.773333 2.389333 27.761778 7.168 8.931556 4.778667 16.839111 11.662222 23.722666 20.593777 6.826667 8.988444 12.344889 19.968 16.497778 33.109334 4.266667 13.084444 6.257778 27.761778 6.257778 43.861333v162.019556c0 19.114667 3.015111 35.953778 8.988444 50.631111 6.030222 14.563556 13.653333 26.794667 22.869334 36.636444 9.216 9.841778 19.569778 17.351111 30.833778 22.414222 11.377778 5.006222 22.698667 7.566222 34.019555 7.566223h62.691556z m509.610666-610.304c19.683556 19.626667 19.683556 65.536-6.542222 91.704889-19.626667 32.768-52.394667 39.310222-85.162667 32.768-6.542222 0-19.626667 0-19.626666-6.542222-13.084444-6.542222-19.683556 0-39.310222 13.084445-6.542222 6.542222-19.683556 19.626667-26.168889 32.768 0 6.542222-6.599111 13.084444 0 19.626666l39.253333 137.557334c13.084444 45.852444 39.310222 58.993778 85.162667 45.852444 13.084444 0 19.683556-6.542222 32.768-6.542222 0 32.768-6.542222 39.310222-32.768 45.852444-39.253333 19.683556-78.620444 32.768-117.930667 19.683556-39.253333-6.542222-65.479111-19.683556-78.563556-65.536-6.542222-19.626667-13.084444-52.394667-19.683555-85.162667-13.084444 19.683556-13.084444 26.168889-19.626667 32.768-19.683556 32.768-39.310222 65.536-58.993778 91.704889-13.084444 19.683556-32.711111 32.768-45.852444 39.310222-32.711111 13.084444-58.936889 0-72.021333-19.626666-13.084444-19.683556-13.084444-65.536 6.542222-91.761778 19.626667-32.711111 52.394667-39.253333 91.704889-32.711111 6.542222 0 13.084444 0 19.626666 6.542222 13.084444 13.084444 26.225778 6.542222 32.768-6.542222 6.542222-13.084444 19.683556-19.683556 19.683556-39.310223 6.542222-6.542222 6.542222-13.084444 0-19.683555-6.599111-39.253333-13.084444-85.162667-26.225778-117.873778-19.626667-52.394667-39.253333-72.078222-91.704889-52.394667-19.683556-13.084444-19.683556-13.084444-32.768-13.084444 0-19.683556 6.542222-39.367111 32.768-45.909333 39.253333-13.084444 78.620444-32.768 117.930667-19.626667 39.253333 6.542222 58.936889 19.626667 78.563556 65.479111 6.599111 19.683556 13.084444 52.394667 19.683555 78.620445 6.542222-6.542222 6.542222-13.084444 13.084445-19.626667 19.683556-32.768 39.310222-65.536 58.936888-91.761778 13.084444-13.084444 19.683556-32.711111 39.310223-39.253333 32.768-13.084444 65.536 0 85.162666 19.626666z m109.795556 610.304c11.377778 0 22.641778-2.56 34.019555-7.566222 11.377778-5.063111 21.617778-12.515556 30.833778-22.414222 9.272889-9.841778 16.839111-22.072889 22.869334-36.693333 5.973333-14.620444 8.931556-31.459556 8.931555-50.574223v-162.019555c0-15.530667 2.048-29.582222 6.257778-42.496 3.697778-11.889778 9.272889-23.04 16.554667-33.109333 6.314667-8.760889 14.392889-16.099556 23.722666-21.504A55.580444 55.580444 0 0 1 1024 560.412444v-60.871111a58.595556 58.595556 0 0 1-27.761778-7.111111 71.623111 71.623111 0 0 1-23.722666-21.048889 113.777778 113.777778 0 0 1-16.497778-33.564444 144.213333 144.213333 0 0 1-6.257778-43.861333V230.968889c0-19.114667-3.015111-35.953778-8.988444-50.574222a118.101333 118.101333 0 0 0-22.869334-36.693334 96.142222 96.142222 0 0 0-30.833778-22.357333A82.659556 82.659556 0 0 0 853.048889 113.777778h-62.691556v53.703111h44.771556c8.931556 0 16.099556 2.275556 21.504 6.712889a47.786667 47.786667 0 0 1 12.970667 17.92c3.299556 7.395556 5.518222 15.758222 6.712888 25.031111 1.137778 9.272889 1.763556 18.944 1.763556 29.127111v161.962667c0 22.641778 3.128889 41.415111 9.443556 56.32 6.257778 14.904889 13.539556 27.022222 21.902222 36.295111 8.419556 9.216 16.839111 15.928889 25.486222 20.138666 8.704 4.152889 15.701333 6.542222 21.048889 7.168v2.673778c-18.147556 5.404444-34.304 15.928889-46.535111 30.435556-8.362667 9.500444-15.644444 21.617778-21.902222 36.238222-6.257778 14.620444-9.443556 32.369778-9.443556 53.304889v162.872889c0 9.500444-0.568889 18.944-1.763556 28.216889-0.967111 8.533333-3.242667 16.782222-6.712888 24.632889a48.696889 48.696889 0 0 1-12.970667 17.408 32.426667 32.426667 0 0 1-21.504 6.712888h-44.771556v53.703112h62.691556v0.056888z" p-id="5084"></path></svg>';

  readonly tag = 'button';

  readonly showModal = true; // 点击 button 时显示 modal

  readonly modalWidth = 500;

  private $content: DOMElement = null as unknown as DOMElement;
  // private $content: Dom7Array | null = null;

  // 获取菜单相关的 val 。如是否加粗、颜色值、h1/h2/h3 等
  getValue(editor: IDomEditor): string | boolean {
    // 插入菜单，不需要 value
    return '';
  }

  //  是否激活菜单，如选区处于加粗文本时，激活 bold
  isActive(editor: IDomEditor): boolean {
    // 任何时候，都不用激活 menu
    return false;
  }

  // button click 或 select change 时触发
  exec(editor: IDomEditor, value: string | boolean) {
    // 点击菜单时，弹出 modal 之前，不需要执行其他代码
    // 此处空着即可
    console.log('exec', value);
  }

  // 是否禁用菜单，如选区处于 code-block 时，禁用 bold 等样式操作
  isDisabled(editor: IDomEditor): boolean {
    // console.log('isDisabled')
    // return isMenuDisabled(editor);
    return false;
  }

  getModalPositionNode(editor: IDomEditor) {
    // console.log('getModalPositionNode')
    if (!editor) {
      return null;
    }
    const toolbar = DomEditor.getToolbar(editor);
    return toolbar && toolbar.$box ? DomEditor.toSlateNode(editor, toolbar.$box[0]) : null; // modal 依据选区定位
  }

  public getModalContentElem(editor: IDomEditor): DOMElement {
    // console.log('getModalContentElem', editor.getConfig());
    // if (this.$content == null) {
    const parent = document.createElement('div');
    // 第一次渲染
    const contextItems = editor.getConfig().EXTEND_CONF['contextItems'];
    const $content = createExpressionDialog(contextItems, editor).mount(parent);
    this.$content = $content.$el;
    // const $contents = $('<div style="height: 100px;">hello</div>');
    // this.$content = $contents[0];
    // }

    return this.$content;
  }
}
